<div class="flex flex-col relative h-full" *ngIf="{ viewStyle: viewStyleControl.value$ | async } as state">
  <div class="flex-none flex items-center w-full bg-neutral-200 gap-6 px-4 h-12">
    <ui-button-group
      label="View"
      [control]="viewStyleControl"
      [items]="[{ icon: 'grid', value: 'grid', hint: 'Grid' }, { icon: 'masonry', value: 'masonry', hint: 'Masonry' }]"
    ></ui-button-group>

    @if(state.viewStyle === 'grid') {
      <ui-field
        [control]="itemPerRowControl"
        type="number"
        label="Items Per Row"
        [min]="2"
        [max]="12"
        width="2.5rem"
        class="text-center"
      ></ui-field>

      <ui-slider
        [control]="itemSizeControl"
        label="Items Aspect Ratio"
        [min]="0.3"
        [max]="1.7"
        [step]="0.05"
      ></ui-slider>
    } @else {
      <ui-field
        [control]="columnsControl"
        type="number"
        label="Columns"
        [min]="3"
        [max]="12"
        width="2.5rem"
        class="text-center"
      ></ui-field>
    }

    <div class="flex-auto"><!-- Spacer --></div>

    <ui-field [control]="searchControl" placeholder="Search..."></ui-field>
  </div>

  <div class="flex-auto flex relative overflow-hidden">
    <div class="flex-auto overflow-auto px-1" (scroll)="onScroll($event)">
      @if(state.viewStyle === 'grid') {
        <div
          class="grid gap-1"
          [style.grid-template-columns]="
        'repeat(' + (itemPerRowControl.value$ | async) + ', minmax(0, 1fr))'
      "
        >
          @for(item of items(); track item.path) {
            <feature-image-card
              [image]="item"
              [style.aspect-ratio]="itemSizeControl.value$ | async"
              [isSelected]="item.path === selectedImage()?.path"
              (onSelect)="selectedImage.set(item)"
            ></feature-image-card>
          }
        </div>
      } @else {
        <ui-masonry [items]="items()" [cols]="(columnsControl.value$ | async) ?? 4" [trackBy]="itemTrackBy">
          <ng-template let-item="item">
            <feature-image-card
              [image]="item"
              [isSelected]="item.path === selectedImage()?.path"
              (onSelect)="selectedImage.set(item)"
            ></feature-image-card>
          </ng-template>
        </ui-masonry>
      }
    </div>
    <feature-image-details-pane
      class="flex-none"
      [image]="selectedImage()"
      [showImage]="true"
    ></feature-image-details-pane>
  </div>
</div>
